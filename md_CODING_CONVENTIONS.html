<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="generator" content="Doxygen 1.8.17" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- BEGIN opengraph metadata -->
    <meta property="og:title" content="Doxygen Awesome" />
    <meta property="og:image"
        content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
    <meta property="og:description"
        content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
    <meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
    <!-- END opengraph metadata -->
    <!-- BEGIN twitter metadata -->
    <meta name="twitter:image:src"
        content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
    <meta name="twitter:title" content="Doxygen Awesome" />
    <meta name="twitter:description"
        content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
    <!-- END twitter metadata -->
    <title>Mesh4all: Coding Conventions</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <link rel="icon" type="image/svg+xml" href="logo.drawio.svg" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
            <table cellspacing="0" cellpadding="0">
                <tbody>
                    <tr style="height: 56px;">
                        <td id="projectlogo"><img alt="Logo" src="m4a-logo.svg" /></td>
                        <td id="projectalign" style="padding-left: 0.5em;">
                            <div id="projectname">Mesh4all
                            </div>
                            <div id="projectbrief">May the mesh be with you</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_CODING_CONVENTIONS.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Coding Conventions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md38"></a>
General</h1>
<ul>
<li>Code shall be <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf">C11</a> compliant.</li>
<li>Avoid dynamic memory allocation (malloc/free, new, etc.)! It will break real-time guarantees, increase code complexity, and make it more likely to use more memory than available.</li>
<li>Avoid the use of floating point arithmetic. Not every MCU has a FPU and software floating point libraries cause unnecessary overhead. Instead use fixed-point integers and transform equations so that they stay within the range of integer math. An easy way to ensure this is by multiplying by a constant factor, ideally a power of two - this is a simple shift operation. Take care that intermediate values do not exceed the range of the data type you are using. When writing drivers, do not convert the measurement data into float, but instead choose an appropriate integer format / SI prefix.</li>
<li>Please obey the Linux coding style as described in <a href="https://www.kernel.org/doc/Documentation/process/coding-style.rst">https://www.kernel.org/doc/Documentation/process/coding-style.rst</a> with the following modifications and additions:<ul>
<li>Line length: aim for no more than 80 characters per line, the absolute maximum should be 100 characters per line.</li>
<li>All line endings shall be set to LF (<code>\n</code>). (How to handle line endings in Git: <a href="https://help.github.com/articles/dealing-with-line-endings">https://help.github.com/articles/dealing-with-line-endings</a>)</li>
<li>There must be no trailing whitespace in any line. The script <code>/dist/tools/whitespacecheck/check.sh main || exit</code> can be used to detect whitespaces at the end of line(s) that would lead to build error(s).</li>
<li>Use empty braces for empty while loops waiting for a hardware register instead of semicolon. <code>while (HW_STATUS != STATUS_OK) {}</code> is correct, <code>while (HW_STATUS != STATUS_OK);</code> is wrong.</li>
<li>Our policy regarding <code>typedef</code>s is <a href="https://www.kernel.org/doc/html/latest/process/coding-style.html#typedefs">completely different</a> (see below) (BTW: Do we have any reason to do so?)</li>
<li>Comments should be C-style comments (see below)</li>
</ul>
</li>
<li>In order to follow Linux's recommendation on <a href="https://www.kernel.org/doc/html/latest/process/coding-style.html#conditional-compilation">conditional compilation</a> make use of <code>IS_ACTIVE</code> and <code>IS_USED</code> macros from <code>kernel_defines.h</code> with C conditionals. If a symbol is not going to be defined under a certain condition, the usage of preprocessor <code>#if defined()</code> is fine.</li>
<li>You can use <a href="http://uncrustify.sourceforge.net/">uncrustify</a> with the provided option files: <a href="https://github.com/Mesh4all/m4a-firmware/blob/main/uncrustify-riot.cfg">https://github.com/Mesh4all/m4a-firmware/blob/main/uncrustify-riot.cfg</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md39"></a>
Types</h1>
<ul>
<li>Be careful with platform dependent type sizes like <code>int</code> or <code>long</code>. Use data types that include the bit length in the name like <code>uint16_t</code> when you need to make sure that a certain variable is exactly of this length.</li>
<li>The use of typedefs for structs and pointers is allowed.</li>
<li>Type definitions (using <code>typedef</code>) always end on "_t".</li>
<li>If a typedef is used for a struct, it has to be specified at the struct definition (i.e., not as a separate line). E.g.: <div class="fragment"><div class="line">typedef struct {</div>
<div class="line">    uint8_t a;</div>
<div class="line">    uint8_t b;</div>
<div class="line">} foobar_t;</div>
</div><!-- fragment --></li>
<li>Use of a separate line typedef for structs is allowed for forward declarations, e.g., <div class="fragment"><div class="line">typedef struct mystruct mystruct_t;</div>
<div class="line">[...]</div>
<div class="line">struct mystruct {</div>
<div class="line">     [...]</div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>Guidelines for pointer types (as long as it is reasonable):<ul>
<li>use <code>char *</code> for strings and only for strings</li>
<li>use <code>uint8_t[]</code> as type for arbitrary byte buffers, but use <code>void *</code> to pass them around. <code>uint8_t[]</code> because we're dealing with bytes and not characters, <code>void *</code> to avoid unnecessary casting shall the need arise to have their content to have a certain type</li>
<li>use <code>uint8_t *</code> to pass "typed" byte buffers, e.g., link-layer addresses, where it avoids unnecessary temporary variable</li>
<li>use <code>void *</code> for generic typing</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md40"></a>
Variables</h1>
<ul>
<li>Do NOT use global variables unless it is unavoidable.</li>
<li>If you declare a variable within a header file, you MUST use the keyword <code>extern</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md41"></a>
Functions</h1>
<ul>
<li>Every function needs a prototype in addition to its definition. If a prototype is specified within a .c file it has to be declared BEFORE any function definitions.</li>
<li>If the scope of a function is limited to one file, it MUST be declared static.</li>
<li>Functions without parameters must be specified with <code>(void)</code>.</li>
<li>Keep functions short! As a rule of thumb, the function's body should not exceed one screen.</li>
<li>Do NOT use global macros defining more than one line of code. Use inline functions instead.</li>
</ul>
<h1><a class="anchor" id="autotoc_md42"></a>
Return values</h1>
<ul>
<li>Every function must return one of the following values or none (void):<ul>
<li>logical value (zero or not zero)</li>
<li>an error code (given as a negative number or zero) or a positive status value</li>
<li>the count of read or written bytes/values for I/O functions</li>
<li>the position or address (for search functions)</li>
<li>a pointer</li>
</ul>
</li>
<li><code>NULL</code> indicates an error case, too.</li>
<li>Do NOT return structs or other larger types! These would get copied to the stack, resulting in expensive operations. Moreover, some compilers have trouble with larger return types. Use pointers to structs instead and take care of the structs lifetime.</li>
<li>If possible, prefer signed types over unsigned ones in order to be able to add error codes later on.</li>
</ul>
<h1><a class="anchor" id="autotoc_md43"></a>
Naming</h1>
<ul>
<li>Names of all public functions and variables must start with the name of the corresponding library, e.g.: <div class="fragment"><div class="line">thread_getpid(void);</div>
<div class="line">hwtimer_init_comp(uint32_t fcpu);</div>
<div class="line">int transceiver_pid;</div>
</div><!-- fragment --></li>
<li>Private functions and variables do NOT have this library prefix.</li>
<li>Do NOT use CamelCase. Function, variable and file names as well as enums, structs or typedefs are written in lowercase with underscores. <div class="fragment"><div class="line">/* instead of: */</div>
<div class="line">void CamelCaseNamedFunction(int camelCaseNamedVar);</div>
<div class="line"> </div>
<div class="line">/* write: */</div>
<div class="line">void camel_case_named_function(int camel_case_named_var);</div>
</div><!-- fragment --></li>
<li>When implementing constants or variables that are defined in third party documents such as RFCs, add a prefix to those names based on the RIOT coding conventions. If you use a name in the RIOT code that is different from the one in the third party document, you must add a reference to the original name of the constant or variable in the Doxygen documentation.</li>
</ul>
<h1><a class="anchor" id="autotoc_md44"></a>
Indentation and braces</h1>
<ul>
<li>Indentations are four spaces (i.e., NO tab characters).</li>
<li>As an exception to the Linux coding style, the closing brace is empty on a line of its own when followed by an else, too. When followed by a <code>while</code> in a <code>do</code>-statement, it goes into the same line.</li>
<li>Use curly braces even for one-line blocks. This improves debugging and later additions. <div class="fragment"><div class="line">/* instead of: */</div>
<div class="line">if (debug) println(&quot;DEBUG&quot;);</div>
<div class="line">else println(&quot;DEBUG ELSE&quot;);</div>
<div class="line"> </div>
<div class="line">/* write: */</div>
<div class="line">if (debug) {</div>
<div class="line">    println(&quot;DEBUG&quot;);</div>
<div class="line">}</div>
<div class="line">else {</div>
<div class="line">    println(&quot;DEBUG ELSE&quot;);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Commas are always followed by a space.</li>
<li>For complex statements it is always good to use more parentheses - or split up the statement and simplify it.</li>
</ul>
<h1><a class="anchor" id="autotoc_md45"></a>
Includes</h1>
<ul>
<li>The include of system headers (in &lt;&gt;-brackets) always precedes RIOT specific includes (in quotes).</li>
<li>Optional headers must only be included if their corresponding module is selected/being build. In other words: always put an <code>#ifdef MODULE_...</code> statement around includes of optional headers: <div class="fragment"><div class="line"><span class="preprocessor">#ifdef MODULE_ABC</span></div>
<div class="line"><span class="preprocessor">#include &quot;abc.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md46"></a>
Header Guards</h1>
<p>All files are required to have header guards of the form</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef PATH_TO_FILE_FILENAME_H</span></div>
<div class="line"><span class="preprocessor">#define PATH_TO_FILE_FILENAME_H</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">#endif <span class="comment">/* PATH_TO_FILE_FILENAME_H */</span></div>
</div><!-- fragment --><p>Rules for generating the guard name:</p>
<ol type="1">
<li>take the file name</li>
<li>if there's <code>include/</code> in the file's pathname, include the path from there on.</li>
<li>replace "/" and "." with "_"</li>
<li>convert to uppercase letters</li>
<li>if the produced guard starts with "_", prefix "PRIV"</li>
</ol>
<p>Examples:</p>
<ul>
<li>"core/include/msg.h" -&gt; "MSG_H"</li>
<li>"sys/include/net/gnrc/pkt.h" -&gt; NET_GNRC_PKT_H</li>
<li>"drivers/abcd0815/abcd0815_params.h" -&gt; ABCD0815_PARAMS_H</li>
<li>"sys/module/_internal.h" -&gt; PRIV_INTERNAL_H</li>
</ul>
<p>Note: these rules will be enforced by the CI.</p>
<h1><a class="anchor" id="autotoc_md47"></a>
C++ compatibility</h1>
<ul>
<li>C Header files should be always wrapped for C++ compatibility to prevent issues with name mangling, i.e. mark all the containing functions and definitions as <code>extern "C"</code> <div class="fragment"><div class="line">#ifdef __cplusplus</div>
<div class="line">extern &quot;C&quot; {</div>
<div class="line">#endif</div>
<div class="line"> </div>
<div class="line">... all your function declarations, global variables and defines belong here</div>
<div class="line"> </div>
<div class="line">#ifdef __cplusplus</div>
<div class="line">}</div>
<div class="line">#endif</div>
</div><!-- fragment --></li>
<li>use <code>__restrict</code> instead of <code>restrict</code> in headers</li>
</ul>
<h1><a class="anchor" id="autotoc_md48"></a>
Absolute values</h1>
<ul>
<li>Absolute values must be specified as macros or enums, not as literals, i.e. instead of <div class="fragment"><div class="line">int timeout = 7 * 1000000;</div>
</div><!-- fragment --></li>
</ul>
<p>write </p><div class="fragment"><div class="line">int timeout = TIMEOUT_INTERVAL * USEC_PER_SEC;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md49"></a>
Comments</h1>
<ul>
<li>All comments should be written as C-style comments.</li>
</ul>
<p>E.g: </p><div class="fragment"><div class="line">/* This is a C-style comment */</div>
</div><!-- fragment --><p>Wrong: </p><div class="fragment"><div class="line">// C++ comment here</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md50"></a>
Documentation</h1>
<ul>
<li>All documentation must be in English.</li>
<li>All files should contain the copyright note.</li>
<li>Doxygen documentation is mandatory for all header files.</li>
<li>Every header file includes a general description about the provided functionality.</li>
<li>Every function must be documented - including parameters and return value.</li>
</ul>
<p>An examplary doxygen documentation in a header file can look like this.</p>
<div class="fragment"><div class="line">/*</div>
<div class="line"> * Copyright (C) 2014 Peter Schmerzl &lt;peter@schmerzl-os.org&gt;</div>
<div class="line"> *</div>
<div class="line"> * This file is subject to the terms and conditions of the GNU Lesser General</div>
<div class="line"> * Public License v2.1. See the file LICENSE in the top level directory for more</div>
<div class="line"> * details.</div>
<div class="line"> */</div>
<div class="line"> </div>
<div class="line">/**</div>
<div class="line"> * @ingroup     foobar</div>
<div class="line"> * @{</div>
<div class="line"> *</div>
<div class="line"> * @file</div>
<div class="line"> * @brief       Definitions for foo and bar functions.</div>
<div class="line"> *</div>
<div class="line"> * More detailed information about the file and the functionality implemented.</div>
<div class="line"> *</div>
<div class="line"> * @author      Peter Schmerzl &lt;peter@schmerzl-os.org&gt;</div>
<div class="line"> *</div>
<div class="line"> */</div>
<div class="line"> </div>
<div class="line">/**</div>
<div class="line"> * @brief   Set the state of foobar.</div>
<div class="line"> *</div>
<div class="line"> * @param[in]  state      The new state of foobar.</div>
<div class="line"> * @param[out] old_state  The old state of foobar is written to this variable.</div>
<div class="line"> *</div>
<div class="line"> * @return 1 if setting the state was successful, 0 otherwise.</div>
<div class="line"> */</div>
<div class="line"> int set_foobar(int state, int *old_state);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md51"></a>
Common compilation warnings</h1>
<p>Some solutions to correctly handle compilation warnings.</p>
<h2><a class="anchor" id="autotoc_md52"></a>
-Wformat</h2>
<p>Solution for string formatting errors:</p>
<ul>
<li>When printing a <code>size_t</code><ul>
<li>use <code>u</code> and cast the variable to <code>(unsigned)</code> because <code>newlib-nano</code> does not support <code>zu</code></li>
</ul>
</li>
<li>When printing an <code>unsigned char/uint8_t</code><ul>
<li>Use <code>u</code> because <code>newlib-nano</code> does not support <code>hu/PRIu8</code></li>
</ul>
</li>
<li>When printing an <code>uint32_t</code><ul>
<li>Use <code>PRIu32</code> print format</li>
</ul>
</li>
<li>When printing <code>64bit</code> variables<ul>
<li>It is not correctly supported by <code>newlib-nano</code>, use <code>fmt</code> module for these in this case.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md53"></a>
-Wformat-nonliteral</h2>
<p>For a <code>printf</code> style function with the following error: <code>error: format string is not a string literal</code>.</p>
<ul>
<li>Function using a variable number of arguments:<ul>
<li>Use <code>__attribute__((__format__ (__printf__, 3, 4)))</code>, where here <code>3</code> is the number of the argument with the format and <code>4</code> the format arguments, starting from 1.</li>
</ul>
</li>
<li>Function using <code>va_list</code>:<ul>
<li>Use <code>__attribute__((__format__ (__printf__, 1, 0)))</code>, where here <code>1</code> is the number of the argument with the format and <code>0</code> as there is no variable numbers of arguments.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md54"></a>
Git</h1>
<ul>
<li>Make one commit per change.</li>
<li>The first line of the commit message describes the main feature of the commit.</li>
</ul>
<h1><a class="anchor" id="autotoc_md55"></a>
Continuous Integration</h1>
<ul>
<li>If the CI tests fail due to errors these errors need to be addressed.</li>
<li>If the CI tests fail due to warnings/errors emitted by cppcheck you should try to fix the error. If the error is definitely a false positive there is the possibility to suppress this warning/error. You MUST do so by adding a comment, including a rationale why it is a false positive and why the code can't be fixed otherwise, in the following format: <div class="fragment"><div class="line">/* cppcheck-suppress &lt;category of error/warning&gt;</div>
<div class="line"> * (reason: cppcheck is being really silly. this is certainly not a</div>
<div class="line"> * null-pointer dereference */</div>
</div><!-- fragment --> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Dec 13 2021 12:49:33 for Mesh4all by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
<script>
  $(function() {
     toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
     toggleButton.title = "Toggle Light/Dark Mode"
     $(document).ready(function(){
       document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
     })
     $(window).resize(function(){
       document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
     })
   })
</script>
</body>
</html>
